extends layout

append scripts
    script(src="/scripts/pages/dbMarketProduct.js" type="module" defer)

block section
    h1= title
        if marketProduct ? marketProduct.variation : false
            a.btn.navigate-btn.navigate-btn--back(href=`/stocks/db/product/${marketProduct.variation.product._id}`)
    form.market-product--form
        case marketType
            when "yandex"
                label SKU:#{" "}
                    input(required name="sku" value=`${marketProduct ? marketProduct.sku ? marketProduct.sku : '' : ''}`)
            when "ozon"
                label SKU:#{" "}
                    input(required name="sku" value=`${marketProduct ? marketProduct.sku ? marketProduct.sku : '' : ''}`)
            when "wb"
                label SKU:#{" "}
                    input(required name="sku" value=`${marketProduct ? marketProduct.sku ? marketProduct.sku : '' : ''}`)
                label Barcode:#{" "}
                    input(required name="barcode" value=`${marketProduct ? marketProduct.barcode ? marketProduct.barcode : '' : ''}`)
            when "woo"
                label ID:#{" "}
                    input(required name="id" value=`${marketProduct ? marketProduct.id ? marketProduct.id : '' : ''}`)
                label.select--arrow Type:#{" "}
                    select.select--style( name="type" required)
                        option(value="" disabled selected hidden) Выберете тип
                          each type in ['simple', 'variation']
                              option(value=type selected=(marketProduct ? type === marketProduct.type : false))= type
                label.select--arrow Parent:#{" "}
                    select.select--style( name="parentVariable" disabled=(marketProduct ? marketProduct.type !== "variation" : true) required)
                        option(value="" disabled selected hidden) Выберете связанный продукт
                          each wooVariableProduct in wooVariableProducts
                              option(value=wooVariableProduct.id selected=(marketProduct ? marketProduct.parentVariable ? wooVariableProduct.id === marketProduct.parentVariable.id : false : false))= wooVariableProduct.id
        label Article:#{" "}
            input(name="article" value=`${marketProduct ? marketProduct.article ? marketProduct.article : '' : ''}`)
        fieldset
            legend Актуальность
            label.inline Актуальный#{" "}
                input(required name="isActual" type="radio" value="true" checked=(marketProduct ? marketProduct.isActual : false))
            label.inline #{" "}Неактуальный#{" "}
                input(required name="isActual" type="radio" value="false" checked=(marketProduct ? !marketProduct.isActual : false))
        label.label--first-half FBS:#{" "}
            input(name="stockFBS" type="number" min=(marketProduct.fbsReserve ? marketProduct.fbsReserve : 0) value=(marketProduct.fbsStock) placeholder="FBS + Reserve")
        label.label--last-half Резерв:#{" "}
            input(required name="reserved" type="" value=marketProduct.fbsReserve disabled)
        if marketProduct
            case marketType
                when "wb"
                    label FBW:#{" "}
                        input(name="stock" type="number" value=(marketProduct.stock) disabled)

                when "ozon"
                    label FBO:#{" "}
                        input(name="stock" type="number" value=(marketProduct.stock) disabled)

        fieldset
            legend Связь с вариацией (необязательно)
            label.select--arrow Продукт:#{" "}
                select.select--style( name="product_id")
                    option(value="") Выберете продукт
                      each product in allProducts
                          option(value=product._id selected=(marketProduct ? marketProduct.variation ? product._id.toString() === marketProduct.variation.product._id.toString() : false : false))= product.name
            label.select--arrow Объем:#{" "}
                select.select--style( name="variation_volume")
                    option(value="") Выберете объем
                      each volume in ['3 мл', '6 мл', '10 мл', 'Набор', 'Стикеры']
                          option(value=volume selected=(marketProduct ? marketProduct.variation ? volume === marketProduct.variation.volume : false : false))= volume

        input(required name="marketType" value=marketType hidden)
        if marketProduct
            input(required name="_id" value=marketProduct._id hidden)
            input.btn.delete-button.delete-button--market-product.inline(type="button")

        input.btn.submit-button.market-product--submit-button(type="button" value=(marketProduct ? "Обновить" : "Добавить") style="float: right;")